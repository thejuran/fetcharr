---
milestone: v1.2
audited: 2026-02-24T23:30:00Z
status: tech_debt
scores:
  requirements: 7/7
  phases: 4/4
  integration: 14/14
  flows: 5/5
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt:
  - phase: 16-deep-code-review
    items:
      - "Deferred M1: No rate limiting on search-now endpoint (medium 78)"
      - "Deferred M2: No CSRF protection on settings POST (medium 77)"
      - "Deferred M3: Unbounded search history table growth (medium 75)"
      - "Deferred M4: No connection pooling for aiosqlite (medium 74)"
      - "Deferred M5: Hardcoded pageSize defaults not configurable (medium 73)"
      - "Deferred M6: No health check endpoint (medium 72)"
      - "Deferred M7: No graceful shutdown handler (medium 71)"
      - "Deferred M8: No request timeout on outbound HTTP calls (medium 70)"
  - phase: 15-search-history-ui
    items:
      - "Cleanup: Unused apps_csv Jinja2 variable in history_results.html line 10"
---

# v1.2 Polish & Harden -- Milestone Audit

**Milestone Goal:** Harden search resilience, improve dashboard observability, and ship CI to GitHub.
**Audited:** 2026-02-24
**Status:** Tech Debt (no blockers, 8 deferred medium issues from deep code review)

## Requirements Coverage (3-Source Cross-Reference)

7/7 active requirements satisfied. 1 requirement dropped (SRCH-17 -- Sonarr handles episode fallback natively).

| REQ-ID | Description | Phase | VERIFICATION.md | SUMMARY Claims | REQUIREMENTS.md | Final |
|--------|-------------|-------|-----------------|----------------|-----------------|-------|
| CICD-04 | CI workflow on GitHub remote runners | 13 | SATISFIED | 13-01: CI with caching | [x] Complete | **satisfied** |
| SRCH-15 | Sonarr v3/v4 API version detection | 13 | SATISFIED | 13-02: version detection | [x] Complete | **satisfied** |
| SRCH-16 | Per-cycle item count diagnostic logging | 13 | SATISFIED | 13-02: diagnostic logging | [x] Complete | **satisfied** |
| WEBU-09 | Dashboard X-of-Y position labels | 14 | SATISFIED | 14-01: position labels | [x] Complete | **satisfied** |
| WEBU-10 | Dashboard application log viewer | 14 | SATISFIED | 14-02: log buffer + viewer | [x] Complete | **satisfied** |
| WEBU-11 | Search log outcome/detail display | 14 | SATISFIED | 14-01: outcome badges | [x] Complete | **satisfied** |
| SRCH-14 | Search history with filtering/pagination | 15 | SATISFIED | 15-01, 15-02: history UI + tests | [x] Complete | **satisfied** |
| ~~SRCH-17~~ | ~~Sonarr episode fallback~~ | ~~16~~ | -- | -- | Dropped | **dropped** (native Sonarr behavior) |

No orphaned requirements. All 7 active REQ-IDs appear in phase VERIFICATIONs.

## Phase Verification Summary

| Phase | Name | Score | Status | Anti-Patterns | Human Verification |
|-------|------|-------|--------|---------------|-------------------|
| 13 | CI & Search Diagnostics | 8/8 | Passed | None | CI remote runner execution |
| 14 | Dashboard Observability | 7/7 | Passed | None | Log viewer live updates, tooltip, scroll |
| 15 | Search History UI | 7/7 | Passed | None | Filter pills, debounce, ellipsis |
| 16 | Deep Code Review | 9/9 | Passed | None | None (all mechanically verifiable) |

**Total:** 31/31 must-haves verified across 4 phases. All passed.

## Cross-Phase Integration

14/14 exports properly consumed. 1 minor orphan (unused template variable). 0 missing connections. 0 broken flows.

| # | From | To | Via | Status |
|---|------|----|-----|--------|
| 1 | `sonarr.py:detect_api_version` (P13) | `startup.py:127` (P13) | `validate_connections()` call | Wired |
| 2 | `engine.py` diagnostic logging (P13) | `log_buffer` (P14) | loguru -> buffer_sink | Wired |
| 3 | `engine.py` outcome/detail (P14) | `db.py` search_history (P14) | `insert_search_entry()` 8 call sites | Wired |
| 4 | `db.py` outcome columns (P14) | `search_log.html` (P14) | `get_recent_searches()` | Wired |
| 5 | `db.py` outcome columns (P14) | `history_results.html` (P15) | `get_search_history()` with COALESCE | Wired |
| 6 | `log_buffer.py` (P14) | `logging.py` + `routes.py` (P14) | write side + read side | Wired |
| 7 | `db.py:get_search_history` (P15) | `routes.py` /history + /partials (P15) | import + call | Wired |
| 8 | `base.html` history nav link (P15) | all pages | template inheritance | Wired |
| 9 | P16 tojson XSS fix | P15 `history_results.html:89` | hx-vals attribute | Wired (non-breaking) |
| 10 | P16 async-with cursors | P14+P15 DB queries | db.py all cursor sites | Wired (non-breaking) |
| 11 | P16 per_page/page guards | P15 /partials/history-results | db.py defense-in-depth | Wired (non-breaking) |
| 12 | P16 safe_int page param | P15 route handler | routes.py line 164 | Wired (non-breaking) |
| 13 | P16 atomic config write | settings save | routes.py tempfile+fsync+os.replace | Wired |
| 14 | P16 pydantic.ValidationError | settings validation | routes.py line 232 | Wired |

## E2E User Flows

5/5 user-facing flows complete:

| Flow | Path | Status |
|------|------|--------|
| Dashboard monitoring | / -> app cards (5s poll) -> search log (5s poll) -> log viewer (5s poll) | Complete |
| Search history browsing | / -> /history -> filter pills -> text search -> pagination | Complete |
| Settings management | / -> /settings -> POST save -> atomic write -> redirect | Complete |
| Manual search trigger | Dashboard -> Search Now -> POST /api/search-now/{name} -> card refresh | Complete |
| Navigation | Dashboard <-> History <-> Settings via nav bar (active state highlighting) | Complete |

## Test Suite

| Phase | New Tests | Coverage |
|-------|-----------|----------|
| 13 | 9 | Version detection (6) + diagnostic logging (3) |
| 14 | 17 | Outcome/detail DB (3) + LogBuffer (7) + log viewer web (3) + position labels (1) + outcome badge (1) + failed search DB (2) |
| 15 | 17 | DB query filtering (9) + web routes (8) |
| 16 | 7 | XSS regression (1) + SSRF blocklist (5) + zero-division (1) |

**Total: 174 tests passing, 0 failures, 0 ruff violations.**

## Tech Debt

### Phase 16: Deferred Medium Issues (from deep code review)

8 medium-severity (70-79 score) issues identified during the v1.2 code review, explicitly deferred to next milestone:

| ID | Issue | Score |
|----|-------|-------|
| M1 | No rate limiting on search-now endpoint | 78 |
| M2 | No CSRF protection on settings POST | 77 |
| M3 | Unbounded search history table growth | 75 |
| M4 | No connection pooling for aiosqlite | 74 |
| M5 | Hardcoded pageSize defaults not configurable | 73 |
| M6 | No health check endpoint | 72 |
| M7 | No graceful shutdown handler | 71 |
| M8 | No request timeout on outbound HTTP calls | 70 |

### Phase 15: Minor Cleanup

- Unused `apps_csv` Jinja2 variable in `history_results.html` line 10 (benign, no runtime impact)

### Human Verification Items (from phase verifications)

These items require a running instance or browser to confirm:

1. CI workflow passes on GitHub Actions remote runners (push needed)
2. Log viewer auto-updates every 5 seconds in browser
3. Outcome detail tooltip appears on hover
4. Log viewer scrollable at max-h-64
5. Filter pills toggle without full page reload
6. Text search debounces at 300ms
7. Pagination ellipsis renders for large datasets

---

*Milestone: v1.2 Polish & Harden*
*Audited: 2026-02-24*
*Auditor: Claude (gsd-audit-milestone)*
