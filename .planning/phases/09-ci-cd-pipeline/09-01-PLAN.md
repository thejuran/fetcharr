---
phase: 09-ci-cd-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - .github/workflows/ci.yml
autonomous: true
requirements:
  - CICD-01
  - CICD-02
  - CICD-03

must_haves:
  truths:
    - "Pushing a commit to main triggers CI that runs all 115+ pytest tests and they pass"
    - "Opening a PR triggers CI that runs ruff linting and fails the build on violations"
    - "Every PR CI run validates that the Docker image builds successfully"
  artifacts:
    - path: ".github/workflows/ci.yml"
      provides: "GitHub Actions CI workflow"
      contains: "pytest"
    - path: "pyproject.toml"
      provides: "Ruff linter configuration"
      contains: "[tool.ruff]"
  key_links:
    - from: ".github/workflows/ci.yml"
      to: "pyproject.toml"
      via: "ruff reads config from pyproject.toml"
      pattern: "ruff check"
    - from: ".github/workflows/ci.yml"
      to: "Dockerfile"
      via: "docker build validates image builds"
      pattern: "docker build"
---

<objective>
Set up GitHub Actions CI pipeline with pytest, ruff linting, and Docker build validation.

Purpose: Every push and PR is automatically validated for correctness, style, and buildability — catching regressions before they reach main.
Output: Working CI workflow at `.github/workflows/ci.yml` and ruff configuration in `pyproject.toml`.
</objective>

<execution_context>
@/Users/julianamacbook/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianamacbook/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@pyproject.toml
@Dockerfile
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ruff configuration to pyproject.toml</name>
  <files>pyproject.toml</files>
  <action>
Add ruff to the `[project.optional-dependencies] dev` list alongside pytest, pytest-asyncio, and pytailwindcss.

Add a `[tool.ruff]` section to pyproject.toml with:
- `target-version = "py311"` (matches requires-python >= 3.11)
- `line-length = 120` (reasonable for a small project)

Add `[tool.ruff.lint]` with:
- `select = ["E", "F", "I", "UP", "B", "SIM"]` — pyflakes, pycodestyle errors, isort, pyupgrade, bugbear, simplify
- No `ignore` list initially — let CI surface anything that needs suppression

Do NOT add ruff as a runtime dependency — dev only.

Run `ruff check fetcharr/ tests/` locally to confirm the codebase passes with no violations. If there are violations, fix them in this task (they should be minor since the codebase was recently cleaned in Phase 8). If violations are purely style (import ordering), auto-fix with `ruff check --fix`.
  </action>
  <verify>
    <automated>cd /Users/julianamacbook/fetcharr && uv run ruff check fetcharr/ tests/</automated>
    <manual>pyproject.toml has [tool.ruff] section and ruff is in dev dependencies</manual>
  </verify>
  <done>Ruff is configured in pyproject.toml, added to dev dependencies, and the entire codebase passes ruff check with zero violations</done>
</task>

<task type="auto">
  <name>Task 2: Create GitHub Actions CI workflow</name>
  <files>.github/workflows/ci.yml</files>
  <action>
Create `.github/workflows/ci.yml` with a single workflow named "CI" triggered on:
- `push` to `main` branch
- `pull_request` to `main` branch

The workflow should have three jobs that run in parallel (no inter-job dependencies):

**Job 1: `test`**
- runs-on: `ubuntu-latest`
- Steps:
  1. `actions/checkout@v4`
  2. Install uv: `astral-sh/setup-uv@v5`
  3. Set up Python 3.13: `actions/setup-python@v5` with `python-version: "3.13"`
  4. Install dependencies: `uv sync --extra dev`
  5. Run tests: `uv run pytest tests/ -x -q`

**Job 2: `lint`**
- runs-on: `ubuntu-latest`
- Steps:
  1. `actions/checkout@v4`
  2. Install uv: `astral-sh/setup-uv@v5`
  3. Set up Python 3.13: `actions/setup-python@v5` with `python-version: "3.13"`
  4. Install dependencies: `uv sync --extra dev`
  5. Run ruff: `uv run ruff check fetcharr/ tests/`

**Job 3: `docker`**
- runs-on: `ubuntu-latest`
- Steps:
  1. `actions/checkout@v4`
  2. Build Docker image: `docker build -t fetcharr:ci-test .`

Key points:
- Use `uv` (not pip) since the project uses uv.lock
- All three jobs run in parallel — no `needs:` between them
- No caching needed initially (keep it simple, optimize later if slow)
- Do NOT push the Docker image — only validate it builds (CICD-03 is build validation only; push is Phase 10)
  </action>
  <verify>
    <automated>cd /Users/julianamacbook/fetcharr && python3 -c "import yaml; y=yaml.safe_load(open('.github/workflows/ci.yml')); jobs=list(y['on'].keys()); assert 'push' in jobs and 'pull_request' in jobs; wjobs=list(y['jobs'].keys()); assert 'test' in wjobs and 'lint' in wjobs and 'docker' in wjobs; print('CI workflow structure valid')" 2>/dev/null || (cat .github/workflows/ci.yml | head -60 && echo "--- Manual check: file exists with push/PR triggers and 3 jobs ---")</automated>
    <manual>Verify .github/workflows/ci.yml has three parallel jobs (test, lint, docker) triggered on push to main and PRs</manual>
  </verify>
  <done>CI workflow exists at .github/workflows/ci.yml with three parallel jobs: pytest test runner, ruff linter, and Docker build validation — all triggered on push to main and pull requests</done>
</task>

</tasks>

<verification>
1. `ruff check fetcharr/ tests/` passes with zero violations
2. `.github/workflows/ci.yml` exists and is valid YAML
3. Workflow triggers on push to main and pull_request to main
4. Three jobs defined: test (pytest), lint (ruff), docker (build)
5. No job has `needs:` dependencies (all run in parallel)
6. Docker job only builds, does NOT push
</verification>

<success_criteria>
- pyproject.toml contains [tool.ruff] configuration and ruff in dev dependencies
- .github/workflows/ci.yml defines a CI pipeline with test, lint, and docker-build jobs
- All three jobs trigger on push to main and pull_request to main
- Codebase passes ruff check locally with zero violations
- Docker build step validates buildability without pushing
</success_criteria>

<output>
After completion, create `.planning/phases/09-ci-cd-pipeline/09-01-SUMMARY.md`
</output>
