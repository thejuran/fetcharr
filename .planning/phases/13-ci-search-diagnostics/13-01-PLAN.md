---
phase: 13-ci-search-diagnostics
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/ci.yml
autonomous: true
requirements:
  - CICD-04

must_haves:
  truths:
    - "CI workflow runs test, lint, and docker jobs on GitHub Actions with Python 3.13"
    - "CI uses uv cache to speed up dependency installation on remote runners"
    - "Docker build job uses BuildKit layer caching for faster rebuilds"
  artifacts:
    - path: ".github/workflows/ci.yml"
      provides: "GitHub Actions CI workflow with caching"
      contains: "actions/cache"
  key_links:
    - from: ".github/workflows/ci.yml"
      to: "pyproject.toml"
      via: "uv sync --extra dev reads dependencies"
      pattern: "uv sync --extra dev"
---

<objective>
Harden the existing CI workflow for reliable, fast execution on GitHub Actions remote runners.

Purpose: The CI workflow already exists from Phase 9 but needs caching for faster runs on remote runners. This ensures CICD-04 is met: CI runs on GitHub and all tests pass.
Output: Updated `.github/workflows/ci.yml` with uv caching and Docker layer caching.
</objective>

<execution_context>
@/Users/julianamacbook/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianamacbook/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.github/workflows/ci.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add caching to CI workflow</name>
  <files>.github/workflows/ci.yml</files>
  <action>
Update `.github/workflows/ci.yml` to add caching for faster remote runner execution:

1. **Test job caching**: Add `actions/cache@v4` step before `uv sync` that caches `~/.cache/uv` with key based on `hashFiles('**/pyproject.toml')`. Restore-keys should fall back to `uv-${{ runner.os }}-`.

2. **Lint job caching**: Same uv cache strategy as test job.

3. **Docker job caching**: Add `docker/setup-buildx-action@v3` step, then update the `docker build` command to use `docker buildx build` with `--cache-from type=gha` and `--cache-to type=gha,mode=max` for GitHub Actions cache backend. Keep the `-t fetcharr:ci-test .` tag and add `--load` so the image is available locally.

Keep everything else unchanged: `on: push/pull_request` to `main`, `runs-on: ubuntu-latest`, Python 3.13 only, three parallel jobs (test, lint, docker) with no inter-job dependencies.

Do NOT add coverage tracking, Tailwind CSS build, or branch protection rules. Single Python version 3.13 only (matches Docker target per CONTEXT.md decisions).
  </action>
  <verify>
    <automated>cd /Users/julianamacbook/fetcharr && python3 -c "import yaml; y=yaml.safe_load(open('.github/workflows/ci.yml')); jobs=y['jobs']; assert 'test' in jobs and 'lint' in jobs and 'docker' in jobs; print('3 jobs present'); assert any('cache' in str(s) for s in jobs['test']['steps']), 'test job missing cache'; assert any('cache' in str(s) for s in jobs['lint']['steps']), 'lint job missing cache'; assert any('buildx' in str(s) for s in jobs['docker']['steps']), 'docker job missing buildx'; print('All caching verified')" 2>/dev/null || echo "YAML parse check skipped (pyyaml not installed) -- verify manually that ci.yml has cache steps in test/lint and buildx in docker"</automated>
    <manual>Review .github/workflows/ci.yml for correct cache key patterns, buildx setup, and no extraneous additions</manual>
  </verify>
  <done>CI workflow has uv caching in test+lint jobs and BuildKit GHA caching in docker job. Three parallel jobs, Python 3.13 only, no coverage or Tailwind build.</done>
</task>

<task type="auto">
  <name>Task 2: Verify CI workflow syntax</name>
  <files>.github/workflows/ci.yml</files>
  <action>
Run a syntax validation on the updated CI workflow:

1. Ensure the YAML is valid by loading it with Python's yaml or a simple parse check.
2. Verify the workflow has the correct `on` triggers (push to main, pull_request to main).
3. Verify all three job names are present: `test`, `lint`, `docker`.
4. Run `uv run ruff check fetcharr/ tests/` to confirm linting passes locally (same as what CI lint job runs).
5. Run `uv run pytest tests/ -x -q` to confirm tests pass locally (same as what CI test job runs).

This task does NOT push to GitHub -- it verifies the workflow file is correct so that when the user pushes, CI will pass on remote runners.
  </action>
  <verify>
    <automated>cd /Users/julianamacbook/fetcharr && uv run pytest tests/ -x -q && uv run ruff check fetcharr/ tests/</automated>
  </verify>
  <done>CI workflow YAML is syntactically valid. Tests and linting pass locally, matching what CI remote runners will execute.</done>
</task>

</tasks>

<verification>
- `.github/workflows/ci.yml` has uv cache in test and lint jobs
- `.github/workflows/ci.yml` has BuildKit GHA cache in docker job
- Three parallel jobs (test, lint, docker) with no dependencies between them
- Python 3.13 only, no coverage, no Tailwind build
- All tests pass locally (`uv run pytest tests/ -x -q`)
- Linting passes locally (`uv run ruff check fetcharr/ tests/`)
</verification>

<success_criteria>
CI workflow is ready to pass on GitHub Actions remote runners with caching for fast execution. When pushed, test/lint/docker jobs will all succeed.
</success_criteria>

<output>
After completion, create `.planning/phases/13-ci-search-diagnostics/13-01-SUMMARY.md`
</output>
