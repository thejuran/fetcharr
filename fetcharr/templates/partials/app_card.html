<div id="{{ app.name }}-card"
     hx-get="/partials/app-card/{{ app.name }}"
     hx-trigger="every 5s"
     hx-swap="outerHTML"
     class="bg-fetcharr-card rounded-lg border border-fetcharr-border p-5
            {% if app.connected == false %}border-l-4 border-l-red-500{% else %}border-l-4 border-l-fetcharr-green{% endif %}">

  <!-- Header: app name + connection status -->
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-lg font-semibold">{{ app.name | capitalize }}</h2>
    {% if app.connected == true %}
      <span class="w-2.5 h-2.5 rounded-full bg-fetcharr-green" title="Connected"></span>
    {% elif app.connected == false %}
      <span class="text-xs bg-red-500/20 text-red-400 px-2 py-0.5 rounded" title="Unreachable">
        Unreachable since {{ app.unreachable_since[:19] | replace('T', ' ') if app.unreachable_since else 'unknown' }}
      </span>
    {% else %}
      <span class="text-xs text-fetcharr-muted">Waiting...</span>
    {% endif %}
  </div>

  <!-- Stats grid -->
  <div class="grid grid-cols-2 gap-3">
    <div>
      <span class="text-xs uppercase tracking-wide text-fetcharr-muted">Last Run</span>
      <p class="text-sm font-medium">{% if app.last_run %}{{ app.last_run[:19] | replace("T", " ") }}{% else %}Never{% endif %}</p>
    </div>
    <div>
      <span class="text-xs uppercase tracking-wide text-fetcharr-muted">Next Run</span>
      <p class="text-sm font-medium">{% if app.next_run %}{{ app.next_run[:19] | replace("T", " ") }}{% else %}&mdash;{% endif %}</p>
    </div>
    <div>
      <span class="text-xs uppercase tracking-wide text-fetcharr-muted">Missing</span>
      <p class="text-sm font-medium">{{ app.missing_count if app.missing_count is not none else '&mdash;' }} items</p>
      <p class="text-xs text-fetcharr-muted">Position {{ app.missing_cursor }}</p>
    </div>
    <div>
      <span class="text-xs uppercase tracking-wide text-fetcharr-muted">Cutoff</span>
      <p class="text-sm font-medium">{{ app.cutoff_count if app.cutoff_count is not none else '&mdash;' }} items</p>
      <p class="text-xs text-fetcharr-muted">Position {{ app.cutoff_cursor }}</p>
    </div>
  </div>

  <!-- Controls -->
  <div class="flex items-center gap-3 mt-4 pt-3 border-t border-fetcharr-border/50">
      <button hx-post="/api/search-now/{{ app.name }}"
              hx-target="#{{ app.name }}-card"
              hx-swap="outerHTML"
              class="bg-fetcharr-green/20 text-fetcharr-green text-xs font-medium px-3 py-1.5 rounded
                     hover:bg-fetcharr-green/30 transition-colors">
          Search Now
      </button>
  </div>
</div>
