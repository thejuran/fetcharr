{% extends "base.html" %}

{% block title %}Settings - Fetcharr{% endblock %}

{% block nav_dashboard_class %}text-fetcharr-muted{% endblock %}
{% block nav_settings_class %}text-white{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6">Settings</h1>

<form method="post" action="{{ url_for('save_settings') }}" class="space-y-8">
    <!-- General section -->
    <section class="bg-fetcharr-card rounded-lg border border-fetcharr-border p-5">
        <h2 class="text-lg font-semibold mb-4">General</h2>
        <div class="grid grid-cols-1 gap-4 max-w-md">
            <div>
                <label class="block text-sm text-fetcharr-muted mb-1">Log Level</label>
                <select name="log_level"
                        class="w-full bg-fetcharr-bg border border-fetcharr-border rounded px-3 py-2 text-sm">
                    {% for level in ['debug', 'info', 'warning', 'error'] %}
                    <option value="{{ level }}" {% if log_level == level %}selected{% endif %}>
                        {{ level | capitalize }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm text-fetcharr-muted mb-1">Hard Max Items Per Cycle</label>
                <input type="number" name="hard_max_per_cycle" value="{{ hard_max_per_cycle }}"
                       min="0" max="1000"
                       class="w-full bg-fetcharr-bg border border-fetcharr-border rounded px-3 py-2 text-sm">
                <p class="text-xs text-fetcharr-muted mt-1">0 = unlimited. Caps total items per app per cycle.</p>
            </div>
        </div>
    </section>

    <!-- Per-app sections: Radarr, Sonarr -->
    {% for name, app in apps.items() %}
    <section class="bg-fetcharr-card rounded-lg border border-fetcharr-border p-5">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold capitalize">{{ name }}</h2>
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="{{ name }}_enabled"
                       {% if app.enabled %}checked{% endif %}
                       class="accent-fetcharr-green w-4 h-4">
                <span class="text-sm">Enabled</span>
            </label>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm text-fetcharr-muted mb-1">URL</label>
                <input type="text" name="{{ name }}_url" value="{{ app.url }}"
                       placeholder="http://{{ name }}:{% if name == 'radarr' %}7878{% else %}8989{% endif %}"
                       class="w-full bg-fetcharr-bg border border-fetcharr-border rounded px-3 py-2 text-sm">
            </div>
            <div>
                <label class="block text-sm text-fetcharr-muted mb-1">API Key</label>
                <input type="password" name="{{ name }}_api_key" value=""
                       placeholder="{{ '********' if app.has_api_key else 'Paste API key' }}"
                       class="w-full bg-fetcharr-bg border border-fetcharr-border rounded px-3 py-2 text-sm">
            </div>
            <div>
                <label class="block text-sm text-fetcharr-muted mb-1">Search Interval (minutes)</label>
                <input type="number" name="{{ name }}_search_interval" value="{{ app.search_interval }}"
                       min="1" class="w-full bg-fetcharr-bg border border-fetcharr-border rounded px-3 py-2 text-sm">
            </div>
            <div>
                <label class="block text-sm text-fetcharr-muted mb-1">Missing Items Per Cycle</label>
                <input type="number" name="{{ name }}_search_missing_count" value="{{ app.search_missing_count }}"
                       min="1" class="w-full bg-fetcharr-bg border border-fetcharr-border rounded px-3 py-2 text-sm">
            </div>
            <div>
                <label class="block text-sm text-fetcharr-muted mb-1">Cutoff Items Per Cycle</label>
                <input type="number" name="{{ name }}_search_cutoff_count" value="{{ app.search_cutoff_count }}"
                       min="1" class="w-full bg-fetcharr-bg border border-fetcharr-border rounded px-3 py-2 text-sm">
            </div>
        </div>
    </section>
    {% endfor %}

    <div class="flex justify-end">
        <button type="submit"
                class="bg-fetcharr-green hover:bg-fetcharr-green-dark text-white font-medium px-6 py-2 rounded transition-colors">
            Save Settings
        </button>
    </div>
</form>
{% endblock %}
